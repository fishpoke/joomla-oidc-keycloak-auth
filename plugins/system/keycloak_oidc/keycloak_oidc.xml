<?xml version="1.0" encoding="utf-8"?>
<extension type="plugin" group="system" method="upgrade">
  <name>plg_system_keycloak_oidc</name>
  <version>0.2</version>
  <creationDate>2026-01-20</creationDate>
  <author>CLM Projekt</author>
  <description>PLG_SYSTEM_KEYCLOAK_OIDC_XML_DESCRIPTION</description>

  <namespace path="src">Fishpoke\Plugin\System\KeycloakOidc</namespace>

  <files>
    <filename plugin="keycloak_oidc">keycloak_oidc.php</filename>
    <folder>src</folder>
    <folder>services</folder>
    <folder>language</folder>
  </files>

  <languages>
    <language tag="en-GB">language/en-GB/plg_system_keycloak_oidc.ini</language>
    <language tag="en-GB">language/en-GB/plg_system_keycloak_oidc.sys.ini</language>
    <language tag="de-DE">language/de-DE/plg_system_keycloak_oidc.ini</language>
    <language tag="de-DE">language/de-DE/plg_system_keycloak_oidc.sys.ini</language>
  </languages>

  <config>
    <fields name="params">
      <fieldset name="basic" label="Basic">
        <field
          name="debug"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="0"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_DEBUG_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_DEBUG_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
      </fieldset>
      <fieldset name="oidc" label="OIDC">
        <field
          name="issuer"
          type="text"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_ISSUER_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_ISSUER_DESC"
        />
        <field
          name="tls_ca_bundle_path"
          type="text"
          default=""
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_TLS_CA_BUNDLE_PATH_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_TLS_CA_BUNDLE_PATH_DESC"
        />
        <field
          name="tls_verify"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="1"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_TLS_VERIFY_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_TLS_VERIFY_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
        <field
          name="security_notice_oidc"
          type="note"
          class="alert alert-danger"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_SECURITY_NOTICE_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_SECURITY_NOTICE_OIDC_DESC"
        />
        <field
          name="keycloak_internal_base"
          type="text"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_KEYCLOAK_INTERNAL_BASE_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_KEYCLOAK_INTERNAL_BASE_DESC"
        />
        <field
          name="client_id"
          type="text"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_CLIENT_ID_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_CLIENT_ID_DESC"
        />
        <field
          name="client_secret"
          type="password"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_CLIENT_SECRET_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_CLIENT_SECRET_DESC"
        />
        <field
          name="scopes"
          type="text"
          default="openid profile email"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_SCOPES_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_SCOPES_DESC"
        />
        <field
          name="enable_frontend"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="1"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_ENABLE_FRONTEND_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_ENABLE_FRONTEND_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
        <field
          name="enable_backend"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="0"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_ENABLE_BACKEND_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_ENABLE_BACKEND_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
        <field
          name="client_auth_in_header"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="1"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_CLIENT_AUTH_IN_HEADER_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_CLIENT_AUTH_IN_HEADER_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
        <field
          name="client_auth_in_body"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="0"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_CLIENT_AUTH_IN_BODY_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_CLIENT_AUTH_IN_BODY_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
      </fieldset>

      <fieldset name="urls" label="URLs">
        <field
          name="joomla_public_base_site"
          type="text"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JOOMLA_PUBLIC_BASE_SITE_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JOOMLA_PUBLIC_BASE_SITE_DESC"
        />
        <field
          name="joomla_public_base_admin"
          type="text"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JOOMLA_PUBLIC_BASE_ADMIN_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JOOMLA_PUBLIC_BASE_ADMIN_DESC"
        />
      </fieldset>

      <fieldset name="jit" label="JIT">
        <field
          name="security_notice_jit"
          type="note"
          class="alert alert-danger"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_SECURITY_NOTICE_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_SECURITY_NOTICE_JIT_DESC"
        />
        <field
          name="jit_enabled"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="0"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_ENABLED_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_ENABLED_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
        <field
          name="jit_auto_link_existing"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="0"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_AUTO_LINK_EXISTING_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_AUTO_LINK_EXISTING_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
        <field
          name="jit_allow_unverified"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="0"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_ALLOW_UNVERIFIED_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_ALLOW_UNVERIFIED_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
        <field
          name="jit_allowed_email_domains"
          type="text"
          default=""
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_ALLOWED_EMAIL_DOMAINS_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_ALLOWED_EMAIL_DOMAINS_DESC"
        />
        <field
          name="jit_group_ids"
          type="text"
          default="2"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_GROUP_IDS_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_GROUP_IDS_DESC"
        />
        <field
          name="jit_allow_privileged"
          type="radio"
          layout="joomla.form.field.radio.switcher"
          default="0"
          label="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_ALLOW_PRIVILEGED_LABEL"
          description="PLG_SYSTEM_KEYCLOAK_OIDC_FIELD_JIT_ALLOW_PRIVILEGED_DESC"
        >
          <option value="0">Disabled</option>
          <option value="1">Enabled</option>
        </field>
      </fieldset>
    </fields>
  </config>


</extension>
